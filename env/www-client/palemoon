case $PV in
26*)
. /etc/portage/env/scripts/mv_patch \
	-e '/MOZ_ASSERT/d' mfbt/Util.h
;;
*)
. /etc/portage/env/scripts/mv_patch \
	-e '/atk-bridge.h/d' config/system-headers \
	-e 's/ atk-bridge[^ ]*//' configure.in

if [ "$PORTAGE_REPO_NAME" = palemoon ]
then
# avoid gcc check of palemoon-27.* ebuilds
pre_pkg_pretend() {
pkg_pretend() {
	# Ensure we have enough disk space to compile:
	CHECKREQS_DISK_BUILD=${REQUIRED_BUILDSPACE}
	check-reqs_pkg_setup

	# Ensure we are not on a gcc 5.* profile:
	einfo "Checking gcc version..."
	if [[ "5" == "$(gcc -dumpversion | cut -d. -f1)" ]]; then
		gcc-5_error
	fi
}
}

# disable system-cairo since it causes random segfaults
mozconfig_enable() {
	local e option
	for option in "$@"; do
		e=enable-${option}
		case $option in
		system-cairo)
			ewarn "mv's local patch:"
			ewarn "disabling system-cairo as it causes segfaults"
			e=disable-${option};;
		esac
		echo "ac_add_options --${e}" >> "${S}/.mozconfig"
	done
}
else
# avoid gcc check of palemoon-27.* ebuilds
pre_pkg_pretend() {
pkg_pretend() {
	# Ensure we have enough disk space to compile:
	CHECKREQS_DISK_BUILD=${REQUIRED_BUILDSPACE}
	check-reqs_pkg_setup

	# Ensure we are not on a gcc 5.* profile:
	if [ "$(cc --version | head -c 3)" == "gcc" ]; then
		einfo "Checking gcc version..."
		if [ "$(gcc -dumpversion | head -c 1)" -ge 5 ]; then
			if [ "$(gcc -dumpversion | head -c 1)" -eq 7 ]; then
				gcc-7_error
			else
				gcc-5_warning
			fi
		fi
	fi
}
}
pre_src_configure() {
	append-ldflags -Wl,-rpath="$EPREFIX/usr/$(get_libdir)/palemoon"
}
fi
;;
esac

