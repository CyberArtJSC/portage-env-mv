
. /etc/portage/env/scripts/mv_rmkeep

mv_rmremotefs() {
	local i r
	rm -v -- \
		"$ED/etc/systemd/system/multi-user.target.wants/remote-fs.target" \
		|| return
	r=1
	for i in "$ED/etc/systemd/system/"*.target "$ED/etc/systemd/system/"*/*.target
	do	test -h "$i" || continue
		r=0
		ln -sfn /usr/lib/systemd/system/"${i##*/}" "$i" || return
	done
	return $r
}

mv_rm_stupidenabling() {
	rm -v -- \
		"${EPREFIX}/etc/systemd/system/dbus-org.freedesktop.network1.service" \
		|| return
}

post_src_install() {
	local f
	f=${PORTAGE_CONFIGROOT%/}/etc/portage/env/$CATEGORY/$PN*
	mv_rmkeep
	einfo "mv's second hack in $f"
	if mv_rmremotefs "$f"
	then	einfo "mv's second hack in $f applied"
	else	die "mv's second hack in $f is redundant or does not apply"
	fi
}

post_pkg_postinst() {
	local f
	f=${PORTAGE_CONFIGROOT%/}/etc/portage/env/$CATEGORY/$PN*
	einfo "mv's third hack in $f"
	if mv_rm_stupidenabling "$f"
	then	einfo "mv's second hack in $f applied"
	else	die "mv's second hack in $f is redundant or does not apply"
	fi
}
