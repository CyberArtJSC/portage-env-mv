commit 812c6e74cf54aefabecda444a24321406fd0f2d9
Author: Martin VÃ¤th <martin@mvath.de>
Date:   Fri Aug 17 13:11:45 2018 +0200

    sh/functions.sh: Avoid bashisms in shell_var()
    
    POSIX shells do not provide a substitution operation ${..//..}
    Negated character classes are marked by [!..] and not [^..] in POSIX.

diff --git a/sh/functions.sh b/sh/functions.sh
index 5895a90..832e58e 100644
--- a/sh/functions.sh
+++ b/sh/functions.sh
@@ -36,7 +36,15 @@ if [ "$INIT" != "openrc" ]; then
 	shell_var() {
 		local output= sanitized_arg=
 		for arg; do
-			sanitized_arg="${arg//[^a-zA-Z0-9_]/_}"
+			sanitized_arg=$arg
+			while :; do
+				case $sanitized_arg in
+				*[!a-zA-Z0-9_]*)
+					sanitized_arg=${sanitized_arg%%[!a-zA-Z0-9_]*}_${sanitized_arg#*[!a-zA-Z0-9_]}
+					continue;;
+				esac
+				break
+			done
 			if [ x"$output" = x"" ] ; then
 				output=$sanitized_arg
 			else
